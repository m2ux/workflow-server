id: review-test-suite
version: 2.0.0
capability: Review test suite quality, coverage, and identify anti-patterns

description: "Assess test quality across the work package â€” coverage gaps, anti-patterns (flaky tests, over-mocking), assertion quality, and test isolation. Produces a quality assessment report."

inputs[1]:
  - id: changed-files
    description: "List of files changed in the work package (from git diff)"
    required: true

protocol:
  load-guidance[2]:
    - Load resource 17 (test-suite-review) for full review criteria
    - Identify all test files in the project related to changed code
  run-tests[1]:
    - Run the test suite to establish a passing baseline
  review-tests[4]:
    - Assess test coverage relative to implementation changes
    - Check for anti-patterns (flaky tests, over-mocking, brittle assertions)
    - Verify test isolation and independence
    - Review assertion quality and error message clarity
  document-findings[2]:
    - Document findings with severity and recommendations
    - Create {NN}-test-suite-review.md report in planning folder
  present-summary[1]:
    - Summarize coverage gaps and critical issues for checkpoint

output[1]:
  - id: test-suite-review-report
    description: "Test suite review report documenting quality assessment"
    artifact:
      name: "{NN}-test-suite-review.md"
    components:
      coverage_assessment: "Coverage analysis relative to changes"
      anti_patterns: "Anti-patterns found with locations"
      recommendations: "Prioritized improvement recommendations"

rules:
  baseline-first: "Run tests before reviewing to establish pass/fail baseline"
  coverage-relative: "Assess coverage relative to the changes made, not absolute project coverage"
  actionable-recommendations: "Every finding must include a concrete improvement suggestion"
  tdd-awareness: "For Rust projects, reference TDD best practices from resource 23"

resources[2]:
  - "17"
  - "23"

tools:
  get_resource:
    when: Starting test review
    params: "workflow_id: work-package, index: 17"
    returns: Full test review guidance document
    usage: Reference for review criteria
  shell:
    when: Running test suite
    usage: Execute tests to verify they pass
  read_file:
    when: Reviewing test implementations
    usage: Examine test structure and assertions
  grep:
    when: Searching for test patterns
    usage: Find test files, check coverage patterns

errors:
  tests_fail:
    cause: Test suite not passing
    recovery: Fix failing tests before review
  no_tests:
    cause: No test files found
    recovery: Document missing tests as critical finding
